//æ‰«ç ä¼ æ–‡ä»¶ - v2.8 (å¯¼èˆªä¼˜åŒ–ç‰ˆ)
import fsys;
import fsys.info;
import fsys.config;
import fsys.dlg.dir;
import fsys.update.simpleMain;
import process;
import web.socket.server;
import win.ui.simpleWindow2;
import qrencode.bitmap;
import win.ui.menu;
import inet.url;
import string.html;
import fonts.fontAwesome;
import win.ui;
import win.clip;
import win.clip.viewer;
/*DSG{{*/
var winform = win.form(text="qrfs - æ‰«ç å¿«ä¼  v2.8";right=798;bottom=491;bgcolor=0xFAFAFA;border="none";max=false)
winform.add(
bk={cls="bk";left=0;top=-5;right=799;bottom=29;bgcolor=0xF0F0F0;dl=1;dr=1;dt=1;forecolor=0xEAEAEA;linearGradient=0;z=10};
bkplus={cls="bkplus";text="qrfs - æ‰«ç å¿«ä¼   v2.8 - å…±äº«æ–‡ä»¶ã€ç”µè„‘å‰ªè´´æ¿ã€æ‰‹æœºè¾“å…¥æ³•ï¼ˆ AI è‡ªåŠ¨ä¼˜åŒ– ï¼‰";left=35;top=3;right=509;bottom=25;align="left";color=0x5A5A5A;dl=1;dt=1;z=11};
btnOpen={cls="plus";text='\uF115';left=430;top=44;right=456;bottom=68;align="right";border={bottom=1;color=0xFF808080};dr=1;dt=1;font=LOGFONT(h=-16;name='FontAwesome');notify=1;z=1};
btnOpenUpload={cls="plus";text="ä¸Šä¼ ç›®å½•";left=473;top=40;right=614;bottom=69;align="left";dl=1;dt=1;font=LOGFONT(h=-14);iconStyle={align="left";font=LOGFONT(h=-15;name='FontAwesome');padding={left=8;top=2}};iconText='\uF07C';notify=1;textPadding={left=27;bottom=1};z=12};
btnSetting={cls="plus";left=737;top=455;right=768;bottom=484;bgcolor=0xFAFAFA;db=1;dl=1;font=LOGFONT(h=-16;name='FontAwesome');iconStyle={align="left";font=LOGFONT(h=-16;name='FontAwesome');padding={left=7;top=3}};iconText='\uF013';notify=1;z=23};
btnStart={cls="plus";text="é‡å¯æœåŠ¡";left=635;top=69;right=768;bottom=106;align="left";bgcolor=0xD9A100;border={radius=8};color=0xFFFFFF;dr=1;dt=1;font=LOGFONT(h=-15);iconStyle={align="left";font=LOGFONT(h=-19;name='FontAwesome');padding={left=16}};iconText='\uF233';notify=1;textPadding={left=45;bottom=2};z=6};
chkAiOpt={cls="checkbox";text="AI ä¼˜åŒ–";left=642;top=461;right=712;bottom=483;bgcolor=0xFAFAFA;z=22};
chkPublicAddress={cls="checkbox";text="å…¬ç½‘ IP";left=486;top=109;right=556;bottom=131;bgcolor=0xFFFFFF;z=24};
editDocumentRoot={cls="plus";left=131;top=46;right=430;bottom=68;align="left";border={bottom=1;color=0xFFC0C0C0};clip=1;dl=1;dr=1;dt=1;editable="edit";textPadding={bottom=1};z=8};
editHost={cls="plus";left=131;top=75;right=456;bottom=97;align="left";border={bottom=1;color=0xFFC0C0C0};dr=1;dt=1;editable="edit";textPadding={bottom=1};z=19};
editPassword={cls="plus";left=131;top=107;right=456;bottom=129;align="left";border={bottom=1;color=0xFFC0C0C0};dr=1;dt=1;editable="edit";password=1;textPadding={right=24;bottom=1};z=14};
editPort={cls="plus";left=529;top=78;right=615;bottom=100;align="left";border={bottom=1;color=0xFFC0C0C0};dr=1;dt=1;editable=1;notify=1;textPadding={bottom=1};z=9};
plus={cls="plus";text="å¯†ç ï¼š";left=71;top=108;right=129;bottom=132;align="right";dl=1;dr=1;dt=1;font=LOGFONT(h=-14);transparent=1;z=13};
plus2={cls="plus";left=38;top=148;right=455;bottom=442;align="left";border={color=0xFFC0C0C0;radius=8;width=1};db=1;dl=1;dr=1;dt=1;font=LOGFONT(h=-14);textPadding={left=16};valign="top";z=2};
plus3={cls="plus";text="è‡ªå®šä¹‰ç½‘å€ï¼š";left=9;top=77;right=129;bottom=101;align="right";dr=1;dt=1;font=LOGFONT(h=-14);transparent=1;z=20};
qr={cls="plus";left=483;top=148;right=768;bottom=433;border={radius=8};db=1;dr=1;dt=1;foreRepeat="scale";repeat="scale";z=7};
radioQrClipboard={cls="radiobutton";text="å…±äº«å‰ªè´´æ¿";left=442;top=461;right=529;bottom=483;bgcolor=0xFAFAFA;db=1;dr=1;z=18};
radioQrInputMethod={cls="radiobutton";text="å…±äº«è¾“å…¥æ³•";left=541;top=461;right=637;bottom=483;bgcolor=0xFAFAFA;db=1;dr=1;z=21};
radioQrRootDir={cls="radiobutton";text="æ ¹ç›®å½•";left=259;top=461;right=346;bottom=483;bgcolor=0xFAFAFA;db=1;dr=1;z=16};
radioQrUploadDir={cls="radiobutton";text="ä¸Šä¼ æ–‡ä»¶";left=350;top=461;right=437;bottom=483;bgcolor=0xFAFAFA;db=1;dr=1;z=17};
static={cls="plus";text="ç«¯å£ï¼š";left=467;top=77;right=530;bottom=101;align="right";dr=1;dt=1;font=LOGFONT(h=-14);transparent=1;z=4};
static2={cls="plus";text="ç½‘ç«™æ ¹ç›®å½•ï¼š";left=15;top=45;right=129;bottom=69;align="right";dl=1;dt=1;font=LOGFONT(h=-14);transparent=1;z=5};
syslink={cls="syslink";text='<a href="https://github.com/aardio/qrfs">å¼€æºé¡¹ç›®</a>';left=43;top=463;right=176;bottom=483;bgcolor=0xFAFAFA;db=1;dl=1;z=15};
txtMessage={cls="richedit";left=43;top=151;right=451;bottom=436;autohscroll=false;bgcolor=0xFAFAFA;db=1;dl=1;dr=1;dt=1;link=1;multiline=1;vscroll=1;z=3}
)
/*}}*/

if( fsys.update.simpleMain(
	"qrfs - æ‰«ç å¿«ä¼ ",
	"http://d.aardio.com/qrfs/update/",
	io.appData("/aardio/std/qrfs/app/update"),
	function(version,description,status){})){
	return 0;	
}

config = fsys.config(io.appData("aardio/std/qrfs")); 

table.mix(config.aiOpt,{
	key =   '\0\1\96';
	url = "https://ai.aardio.com/api/v1/";
	model = "prompt";	
	systemPrompt = /*ä½ æ˜¯è¯­éŸ³è¾“å…¥æ³•ä¼˜åŒ–åŠ©æ‰‹ã€‚

# ä»»åŠ¡

ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬æ˜¯ä½¿ç”¨è¯­éŸ³è¾“å…¥æ³•è¾“å…¥çš„çš„è¯­éŸ³è¯†åˆ«ç»“æœã€‚
ä½ çš„ä»»åŠ¡æ˜¯åœ¨è¯„ä¼°ä¸å°Šé‡ç”¨æˆ·åŸæ„çš„åŸºç¡€ä¸Šå¯¹è¯†åˆ«ç»“æœè¿›è¡Œè¯„ä¼°ä¸ä¿®å¤ï¼Œçº æ­£è¯­éŸ³è¯†åˆ«é”™è¯¯ã€‚
åœ¨ä¿æŒä¸å°Šé‡ç”¨æˆ·åŸæ„çš„åŸºç¡€ä¸Šä¿®æ­£é”™è¯¯çš„æ–‡æ³•ä¸ä¸é€šé¡ºä¹‹å¤„ï¼Œå¹¶åˆç†ä½¿ç”¨æ ‡ç‚¹ç¬¦å·ã€‚
ç„¶ååœ¨åœ¨ä¿æŒä¸å°Šé‡ç”¨æˆ·åŸæ„çš„åŸºç¡€ä¸Šï¼Œä½ åº”å½“è¯„ä¼°è¾“å…¥å¹¶æ ¹æ®ç›¸å…³çš„æ–‡åŒ–ä¸èƒŒæ™¯çŸ¥è¯†å¯¹è¯†åˆ«ç»“æœçš„æ ¼å¼è¿›è¡Œæ•´ç†ä¸ä¼˜åŒ–ï¼Œä½¿æ–‡æœ¬æ›´ä¸ºé€šé¡ºè‡ªç„¶ã€‚
è¾“å‡ºæ ¼å¼ä¸ºçº¯æ–‡æœ¬ï¼Œä¸ä½¿ç”¨ Markdown æ ‡è®°ï¼ˆé™¤éè¯†åˆ«ç»“æœæœ¬èº«åŒ…å« Markdown æ ‡è®°ï¼‰ã€‚
*/
});

import sessionHandler.default;
sessionHandler.default.root = io.appData("aardio/std/qrfs/session")

if( #config.winform.documentRoot && io.exist(config.winform.documentRoot) ){
	winform.editDocumentRoot.text = config.winform.documentRoot;
}
else {
	winform.editDocumentRoot.text = io.getSpecial(0x5/*_CSIDL_MYDOCUMENTS*/)
}

if(config.winform.qrDir=="upload"){
	winform.radioQrUploadDir.checked = true; 
}
elseif(config.winform.qrDir=="clipboard"){
	winform.radioQrClipboard.checked = true;
}
elseif(config.winform.qrDir=="input"){
	winform.radioQrInputMethod.checked = true;
}
else {
	winform.radioQrRootDir.checked = true;
} 
winform.editHost.text = config.winform.editHost;

var wsrv = web.socket.server();
var srvHttp = wsrv.httpServer;
srvHttp.documentRoot = winform.editDocumentRoot.text;
srvHttp.userToken = string.random(18);
winform.editPassword.text = srvHttp.userToken;

var cacheSysIcons = {}
var getSysIconIndex = function(path){ 
	var sfi;
	sfi = fsys.info.get(path, 0x100/*_SHGFI_ICON*/ | 0x4000/*_SHGFI_SYSICONINDEX*/|0x10/*_SHGFI_USEFILEATTRIBUTES*/, 
		..fsys.isDir(path)?0x10/*_FILE_ATTRIBUTE_DIRECTORY*/?0x80/*_FILE_ATTRIBUTE_NORMAL*/);
	 
	if( !(sfi.returnValue ) ) return; 
	
	if(!cacheSysIcons[sfi.iIcon]){
		var bmp = ..gdip.bitmap(sfi.hIcon,1/*_IMAGE_ICON*/);
		if(bmp){
			cacheSysIcons[sfi.iIcon] = bmp.saveToBuffer(".png"); 
			bmp.dispose();
		}
	}
	if(sfi.hIcon)::DestroyIcon(sfi.hIcon);	
	return sfi.iIcon;
}

var formatSize = function(size){
	if(size===null) return "";
	if(size < 1024) return size + " B";
	if(size < 1024*1024) return string.format("%.1f KB", size/1024);
	if(size < 1024*1024*1024) return string.format("%.1f MB", size/(1024*1024));
	return string.format("%.1f GB", size/(1024*1024*1024));
}

var cacheClientIps = {}

// ç”Ÿæˆé€šç”¨ HTML å¤´éƒ¨
var getHtmlHead = function(activeTab){
	return `
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>qrfs - æ‰«ç å¿«ä¼ </title>
<script>`+$`\include\filepond.min.js`+`</script>
<style>`+$`\include\filepond.min.css`+`</style>
<style>
:root {
	--bg-color: #f7f9fc;
	--card-bg: #ffffff;
	--text-primary: #2c3e50;
	--text-secondary: #5e6d82;
	--border-color: #ebEEF5;
	--accent-color: #0366d6;
	--accent-hover: #024ea4;
	--danger-color: #ff4757;
	--upload-area-bg: #eef2f7;
	--shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);
	--nav-height: 50px;
}

@media (prefers-color-scheme: dark) {
	:root {
		--bg-color: #121212;
		--card-bg: #1e1e1e;
		--text-primary: #e0e0e0;
		--text-secondary: #a0a0a0;
		--border-color: #333;
		--accent-color: #58a6ff;
		--accent-hover: #79c0ff;
		--danger-color: #ff6b6b;
		--upload-area-bg: #2d2d2d;
		--shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.2);
	}
}

*, *::before, *::after { box-sizing: border-box; }

body {
	margin: 0;
	padding: 0;
	padding-top: calc(var(--nav-height) + max(10px, env(safe-area-inset-top))); 
	padding-bottom: max(20px, env(safe-area-inset-bottom));
	background-color: var(--bg-color);
	color: var(--text-primary);
	font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
	-webkit-font-smoothing: antialiased;
}

/* é¡¶éƒ¨å¯¼èˆªæ  */
.nav-header {
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	z-index: 100;
	background: rgba(255, 255, 255, 0.95);
	backdrop-filter: blur(12px);
	-webkit-backdrop-filter: blur(12px);
	border-bottom: 1px solid var(--border-color);
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
	padding-top: max(0px, env(safe-area-inset-top));
}

@media (prefers-color-scheme: dark) {
	.nav-header { background: rgba(30, 30, 30, 0.95); }
}

.nav-tabs {
	display: flex;
	height: var(--nav-height);
	padding: 0;
	margin: 0;
	list-style: none;
}

.nav-tabs li {
	flex: 1;
	display: flex;
	align-items: center;
	justify-content: center;
}

.nav-tabs a {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	width: 100%;
	height: 100%;
	text-decoration: none;
	color: var(--text-secondary);
	font-size: 0.85rem;
	font-weight: 500;
	transition: all 0.2s;
	border-bottom: 2px solid transparent;
	gap: 2px;
}

.nav-tabs a .nav-icon {
	font-size: 1.2rem;
}

.nav-tabs a:hover {
	color: var(--accent-color);
	background: rgba(3, 102, 214, 0.05);
}

.nav-tabs a.active {
	color: var(--accent-color);
	border-bottom-color: var(--accent-color);
	background: rgba(3, 102, 214, 0.08);
}

/* ä¸Šä¼ åŒºåŸŸæ ·å¼ */
.upload-section {
	padding: 15px;
	margin-bottom: 10px;
}

.filepond--root { margin-bottom: 0; min-height: 120px !important; }
.filepond--panel-root { background-color: var(--card-bg); border: 2px dashed var(--border-color); border-radius: 12px; }
.filepond--drop-label { color: var(--text-secondary); font-size: 1rem; }

.native-upload {
	display: block; width: 100%; padding: 15px;
	background: var(--card-bg); border: 2px dashed var(--border-color);
	border-radius: 12px; color: var(--text-secondary); text-align: center;
}

.page-title {
	font-size: 1.1rem;
	margin: 15px 15px 15px 15px;
	color: var(--text-secondary);
	font-weight: 600;
}

ul.file-list {
	list-style: none; padding: 0 15px; margin: 0;
	display: flex; flex-direction: column; gap: 10px;
}

ul.file-list li {
	background: var(--card-bg); border-radius: 10px;
	box-shadow: var(--shadow);
	display: flex; align-items: center; overflow: hidden;
	transition: transform 0.1s;
}
ul.file-list li:active { transform: scale(0.99); }

ul.file-list li a {
	flex: 1; display: flex; align-items: center;
	padding: 16px; text-decoration: none;
	color: var(--text-primary); font-size: 1rem; overflow: hidden;
}

ul.file-list li img { width: 24px; height: 24px; margin-right: 12px; object-fit: contain; flex-shrink: 0; }
ul.file-list li span.fname { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; margin-right: 10px; }
ul.file-list li span.fsize { font-size: 0.8rem; color: var(--text-secondary); white-space: nowrap; }

.del-btn {
	background-color: var(--danger-color); color: white;
	border: none; padding: 0 16px; height: auto;
	font-weight: 600; font-size: 0.9rem; cursor: pointer;
	align-self: stretch; display: flex; align-items: center;
	margin-left: 1px;
}

/* åŠŸèƒ½å®¹å™¨ */
.func-container {
	padding: 0 15px; 
	display: flex; 
	flex-direction: column; 
	height: calc(100vh - var(--nav-height) - max(10px, env(safe-area-inset-top)) - 50px - max(20px, env(safe-area-inset-bottom)));
	height: calc(100dvh - var(--nav-height) - max(10px, env(safe-area-inset-top)) - 50px - max(20px, env(safe-area-inset-bottom)));
}

.func-content {
	flex: 1; width: 100%; padding: 15px;
	border: 1px solid var(--border-color); border-radius: 12px;
	font-size: 1.1em; background-color: var(--card-bg); color: var(--text-primary);
	resize: none; line-height: 1.6; outline: none; margin-bottom: 15px;
	overflow: auto;
}
.func-content:focus { border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1); }

.btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
.btn-main {
	flex: 1; min-width: 120px; padding: 14px; border: none; border-radius: 10px;
	font-size: 1rem; font-weight: 600; cursor: pointer;
	color: white; text-align: center;
}
.btn-copy { background-color: var(--accent-color); }
.btn-send { background-color: #2ecc71; }
.btn-clear { background-color: #95a5a6; }

/* æç¤ºå¡ç‰‡ */
.tip-card {
	background: var(--upload-area-bg);
	border-radius: 8px;
	padding: 10px 12px;
	margin-bottom: 10px;
	color: var(--text-secondary);
	font-size: 0.85rem;
	line-height: 1.5;
}

.tip-card .tip-icon {
	font-size: 1rem;
	margin-right: 6px;
	vertical-align: middle;
}

/* é“¾æ¥å¡ç‰‡ */
.link-card {
	display: flex;
	align-items: center;
	justify-content: center;
	background: var(--card-bg);
	border: 1px solid var(--border-color);
	border-radius: 12px;
	padding: 20px;
	margin: 15px;
	text-decoration: none;
	color: var(--accent-color);
	font-weight: 600;
	box-shadow: var(--shadow);
	transition: all 0.2s;
}

.link-card:hover {
	background: var(--accent-color);
	color: white;
	transform: translateY(-2px);
}

.link-card .link-icon {
	margin-right: 10px;
	font-size: 1.2rem;
}

.toast {
	position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
	background: rgba(0,0,0,0.8); color: #fff; padding: 12px 24px;
	border-radius: 25px; font-size: 0.9em; z-index: 9999;
	opacity: 0; transition: opacity 0.3s; pointer-events: none;
}
.toast.show { opacity: 1; }

.empty-tip { text-align: center; padding: 40px; color: var(--text-secondary); }

.success-msg {
	text-align: center;
	padding: 30px;
	color: #2ecc71;
	font-size: 1.1rem;
}

.success-msg .check-icon {
	font-size: 3rem;
	margin-bottom: 15px;
	display: block;
}
</style>
</head>
<body>

<div id="toast" class="toast"></div>

<nav class="nav-header">
	<ul class="nav-tabs">
		<li><a href="/?t=`+srvHttp.userToken+`" class="`+(activeTab=="files"?"active":"")+`"><span class="nav-icon">ğŸ“</span><span>æ–‡ä»¶</span></a></li>
		<li><a href="/%3Cupload%3E/?t=`+srvHttp.userToken+`" class="`+(activeTab=="upload"?"active":"")+`"><span class="nav-icon">ğŸ“¤</span><span>ä¸Šä¼ </span></a></li>
		<li><a href="/%3Cclipboard%3E/?t=`+srvHttp.userToken+`" class="`+(activeTab=="clipboard"?"active":"")+`"><span class="nav-icon">ğŸ“‹</span><span>å‰ªè´´æ¿</span></a></li>
		<li><a href="/%3Cinput%3E/?t=`+srvHttp.userToken+`" class="`+(activeTab=="input"?"active":"")+`"><span class="nav-icon">âŒ¨ï¸</span><span>è¾“å…¥æ³•</span></a></li>
	</ul>
</nav>

<script>
let websocket;
let wsReconnectAttempts = 0;
const wsUrl = "`+wsrv.getUrl("ws",true)+`";

function connectWebSocket() {
	websocket = new WebSocket(wsUrl);
	websocket.onopen = function() { wsReconnectAttempts = 0; };
	websocket.onmessage = function(evt) {
		if (evt.data === "reload") {
			`+(activeTab=="files"?"window.location.reload();":"")+`
		} else {
			const clipboardContent = document.getElementById('clipboardContent');
			if (clipboardContent /*&& document.activeElement !== clipboardContent*/) {
				if(evt.data!=clipboardContent.value ){
					clipboardContent.value = evt.data;
					clipboardContent.select();
				} 
			}
		}
	};
	websocket.onclose = function() {
		if (wsReconnectAttempts < 5) {
			const delay = Math.min(1000 * Math.pow(1.5, wsReconnectAttempts), 10000);
			setTimeout(connectWebSocket, delay);
			wsReconnectAttempts++;
		}
	};
}
connectWebSocket();

function showToast(msg) {
	const toast = document.getElementById('toast');
	toast.textContent = msg;
	toast.classList.add('show');
	setTimeout(() => toast.classList.remove('show'), 2000);
}

function deleteFile(path, btn) {
	if(event) { event.preventDefault(); event.stopPropagation(); }
	if (!confirm('ç¡®å®šè¦åˆ é™¤æ­¤æ–‡ä»¶å—ï¼Ÿ')) return;
	
	fetch('/%3Cupload%3E/?t=`+srvHttp.userToken+`', { method: 'DELETE', body: path })
	.then(res => {
		if (res.ok) {
			const li = btn.closest('li');
			li.style.opacity = '0';
			setTimeout(() => {
				li.remove();
				if(document.querySelectorAll('ul.file-list li').length === 0) {
					document.querySelector('ul.file-list').innerHTML = '<li class="empty-tip">ğŸ“­ ç›®å½•ä¸ºç©º</li>';
				}
			}, 300);
			showToast('å·²åˆ é™¤');
		} else { showToast('åˆ é™¤å¤±è´¥'); }
	}).catch(() => showToast('è¯·æ±‚å¤±è´¥'));
}
</script>
`;
}

srvHttp.run( 
	function(response,request,session){ 
	 
		response.headers["Cache-Control"] = "no-cache, no-store, must-revalidate";
		response.headers["Pragma"] = "no-cache";
		response.headers["Expires"] = "0";
		 
		var token = request.get["t"] : session["token"];
		if( #srvHttp.userToken && (token != srvHttp.userToken) ){
			winform.txtMessage.printf("å®¢æˆ·ç«¯ï¼š%s è¿æ¥è¢«æ‹’ç»",request.remoteAddr);	
			response.errorStatus(401)
			return;
		}
		session["token"] = token;
		
		if(!cacheClientIps[request.remoteAddr]){
			winform.txtMessage.printf("å®¢æˆ·ç«¯ï¼š%s å·²è¿æ¥",request.remoteAddr);	
			cacheClientIps[request.remoteAddr] = true;
		}
		
		response.headers["Access-Control-Allow-Origin"] = "*";
		response.headers["Access-Control-Allow-Headers"] = "*"
	
		// å›¾æ ‡è¯·æ±‚
		if(request.path=="/main.aardio" && request.get["icon"]){
			var iconIdx = tonumber(request.get["icon"]);
			if(iconIdx!==null && cacheSysIcons[iconIdx]){
				response.contentType = "image/png";
				response.write(cacheSysIcons[iconIdx])
				return;
			}
			response.errorStatus(404);
			return;
		}
		
		// ä¸Šä¼ å¤„ç†
		if(request.path=="/<upload>/main.aardio"){ //æ³¨æ„è¯·æ±‚ç›®å½•ä¼šè‡ªåŠ¨é™„åŠ é»˜è®¤æ–‡æ¡£è·¯å¾„ /main.aardio 
			if(request.method=="DELETE"){
				var path = request.postData();
				if(path && string.startsWith(path,"/upload/")){
					if(string.find(path,"\.\.")) { response.errorStatus(403); return; }
					
					path = ..io.joinpath(srvHttp.documentRoot,path)
					if(io.exist(path)){
						io.remove(path);
						winform.txtMessage.print("å·²åˆ é™¤ï¼š" + path);
						response.close();
						return;	
					}
				}
				response.errorStatus(404);
				return;
			}
			
			fileData = request.postFileData()
			if(fileData){
				io.createDir(..io.joinpath(srvHttp.documentRoot,"upload"))
				
				var fileName = ..io.joinpath(srvHttp.documentRoot,"upload",fileData.filepond.filename) 
				var ok,err = fileData.filepond.save(fileName); 
				if(!ok){ response.error(err); }
				
				winform.txtMessage.text = 'HTTP æœåŠ¡ç«¯å·²å¯åŠ¨: \n'; 
				winform.txtMessage.print( srvHttp.getUrl(,true) + "/?t=" + srvHttp.userToken  );
				winform.txtMessage.print( "" ); 	
				winform.txtMessage.print( "ä¸Šä¼ æˆåŠŸï¼š" + fileName ); 	
				
				response.contentType = "text/plain";
				response.write("/upload/",fileData.filepond.filename)
				return response.close() 
			} 		
		}
		
		// ç¡®å®šå½“å‰é¡µé¢ç±»å‹
		var pageType = "files";
		if(request.path=="/<clipboard>/main.aardio") pageType = "clipboard";
		elseif(request.path=="/<input>/main.aardio") pageType = "input";
		elseif(request.path=="/<upload>/main.aardio") pageType = "upload";
		elseif(string.startsWith(request.path,"/upload/")) pageType = "files";
		
		// æ–‡ä»¶æµè§ˆå¤„ç†
		if(pageType=="files"){
			if(!fsys.isDir(request.path)) {
				if( ..io.exist(request.path) && (!_STUDIO_INVOKED || request.path!="/main.aardio") )
					return response.loadcode(request.path)
				else {
					request.path = fsys.getParentDir(request.path)
				}
			}
		}
		
		// è¾“å‡º HTML å¤´éƒ¨
		response.write(getHtmlHead(pageType));
		
		// ä¸Šä¼ é¡µé¢
		if(pageType=="upload"){
			response.write(`
<h3 class="page-title">ğŸ“¤ ä¸Šä¼ æ–‡ä»¶</h3>

<div class="upload-section">
	<input type="file" class="filepond" name="filepond" multiple>
</div>

<script>
if (typeof FilePond !== 'undefined') {
	FilePond.create(document.querySelector('input[type="file"]'), {
		//è¿™é‡Œä¸èƒ½å†™ %3Eupload%3Eï¼Œå› ä¸º FilePond ä¼šå†æ¬¡è¿›è¡Œ URL ç¼–ç 
		server: '/<upload>/?t=`+srvHttp.userToken+`',
		labelIdle: 'ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ ',
		labelFileProcessingComplete: 'ä¸Šä¼ æˆåŠŸ',
		credits: false,
		onprocessfiles: function() {
			showToast('ä¸Šä¼ å®Œæˆ');
		}
	});
} else {
	const input = document.querySelector('input[type="file"]');
	input.className = 'native-upload';
	input.insertAdjacentHTML('afterend', '<p style="text-align:center;color:var(--text-secondary)">é€‰æ‹©æ–‡ä»¶åè‡ªåŠ¨ä¸Šä¼ </p>');
}
</script>

<a class="link-card" href="/upload/?t=`+srvHttp.userToken+`">
	<span class="link-icon">ğŸ“‚</span>
	<span>æŸ¥çœ‹å·²ä¸Šä¼ çš„æ–‡ä»¶</span>
</a>

</body></html>`);
			return;
		}
		
		// å‰ªè´´æ¿é¡µé¢
		if(pageType=="clipboard"){
			var clipText = win.clip.read() : "";
			response.write(`
<h3 class="page-title">ğŸ“‹ å…±äº«å‰ªè´´æ¿</h3>

<div class="func-container">
	<textarea id="clipboardContent" class="func-content" placeholder="ä¿®æ”¹è¿™é‡Œçš„æ–‡æœ¬ï¼Œå°†åŒæ­¥ä¿®æ”¹ç”µè„‘å‰ªè´´æ¿...">`
	+string.html.escape(clipText)+`</textarea>
	
	<div class="tip-card">
		<span class="tip-icon">ğŸ’¡</span> 
		<span id="pasteTip"></span>
	</div>
	
	<div class="btn-group">
		<button id="copyBtn" class="btn-main btn-copy">ğŸ“„ å¤åˆ¶åˆ°æ‰‹æœº</button>
	</div>
</div>

<script>
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
const isAndroid = /Android/i.test(navigator.userAgent);

const copyBtn = document.getElementById('copyBtn');

let pasteTip = 'ä½¿ç”¨ Ctrl+V ç²˜è´´å†…å®¹åˆ°è¾“å…¥æ¡†';
if (isIOS) {
	pasteTip = 'é•¿æŒ‰è¾“å…¥æ¡† â†’ é€‰æ‹©"ç²˜è´´"';
} else if (isAndroid) {
	pasteTip = 'é•¿æŒ‰è¾“å…¥æ¡† â†’ ç‚¹å‡»"ç²˜è´´"';
} else if (isMobile) {
	pasteTip = 'é•¿æŒ‰è¾“å…¥æ¡†è¿›è¡Œç²˜è´´';
}
else{
	copyBtn.textContent = "ğŸ“„ å¤åˆ¶åˆ°æœ¬æœº"
}

document.getElementById('pasteTip').textContent = pasteTip;

const clipboardContent = document.getElementById('clipboardContent');
clipboardContent.addEventListener('input', (e) => {
	if (websocket && websocket.readyState === WebSocket.OPEN) {
		var data = JSON.stringify({
			event:"clipboard",
			content:e.target.value
		});
		websocket.send(data);
	}
});

copyBtn.addEventListener('click', async function() {
	try {
		await navigator.clipboard.writeText(clipboardContent.value);
		showToast('âœ“ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
	} catch (e) {
		clipboardContent.select();
		document.execCommand('copy');
		showToast('âœ“ å·²å°è¯•å¤åˆ¶');
	}
});

clipboardContent.select();
</script>
</body></html>`);
			return;
		}
		
		// è¾“å…¥æ³•é¡µé¢
		if(pageType=="input"){
			response.write(`
<h3 class="page-title">âŒ¨ï¸ å…±äº«è¾“å…¥æ³•</h3>

<div class="func-container">
	<textarea id="inputContent" class="func-content" placeholder="åœ¨æ­¤è¾“å…¥æ–‡å­—ï¼Œç‚¹å‡»å‘é€åå°†è¾“å…¥åˆ°ç”µè„‘å½“å‰ç„¦ç‚¹ä½ç½®..."></textarea>
	  
	<div class="btn-group">
		<button id="clearBtn" class="btn-main btn-clear">ğŸ—‘ï¸ æ¸…ç©º</button>
		<button id="sendBtn" class="btn-main btn-send">ğŸ“¨ å‘é€åˆ°ç”µè„‘</button>
	</div>
</div>

<script>
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
if (!isMobile) {
	document.getElementById('sendBtn').textContent = 'ğŸ“¨ å‘é€åˆ°æœåŠ¡ç«¯';
}

const inputContent = document.getElementById('inputContent');
 
document.getElementById('sendBtn').addEventListener('click', async function() {
	if(!inputContent.value.trim()) {
		showToast('è¯·å…ˆè¾“å…¥å†…å®¹');
		return;
	}
	try {
		var data = JSON.stringify({
			event:"input",
			content:inputContent.value 
		});
		websocket.send(data);
		showToast('âœ“ å·²å‘é€åˆ°ç”µè„‘');
		inputContent.value = "";
		inputContent.focus();
	} catch (e) { 
		showToast('å‘é€å¤±è´¥: ' + e.message);
	}
});

document.getElementById('clearBtn').addEventListener('click', function() {
	inputContent.value = "";
	inputContent.focus();
	showToast('å·²æ¸…ç©º');
});

inputContent.focus();

</script>
</body></html>`);
			return;
		}
		
		// æ–‡ä»¶åˆ—è¡¨é¡µé¢
		var pathDisplay = string.html.escape(inet.url.decode(request.path));
		var isUploadDir = string.startsWith(request.path,"/upload");
		
		if(request.path=="/") {
			pathDisplay = "ğŸ“ å…¨éƒ¨æ–‡ä»¶";
		}
		elseif(request.path=="/upload/" || request.path=="/upload") {
			pathDisplay = "ğŸ“¤ å·²ä¸Šä¼ çš„æ–‡ä»¶";
		}
		
		response.write(`<h3 class="page-title">` + pathDisplay + `</h3>`);
		
		// æ˜¾ç¤ºè¿”å›ä¸Šçº§æŒ‰é’®ï¼ˆéæ ¹ç›®å½•æ—¶ï¼‰
		if(request.path!="/") {
			var parentPath = fsys.getParentDir(request.path);
			if(!#parentPath) parentPath = "/";
			response.write(`<a class="link-card" href="`+parentPath+`?t=`+srvHttp.userToken+`" style="margin-top:0;">
				<span class="link-icon">â¬†ï¸</span>
				<span>è¿”å›ä¸Šä¸€çº§</span>
			</a>`);
		}
		
		response.write(`<ul class="file-list">`);
		
		// æ ¹ç›®å½•æ˜¾ç¤ºä¸Šä¼ ç›®å½•å…¥å£
		if(request.path=="/" && ..io.exist("/upload/")){
			response.write('<li><a href="/upload/?t='+srvHttp.userToken+'"><img src="/?icon='++getSysIconIndex("/upload/")
				++'"><span class="fname">ğŸ“¤ å·²ä¸Šä¼ çš„æ–‡ä»¶</span></a></li>\r\n');	
		}
		
		if(!..fsys.isDir(request.path)){
			return response.errorStatus(404); 
		}
		var file,dir = fsys.list(request.path,,"*.*");
		var hasContent = false;
		
		for(i=1;#dir;1){
			if(dir[i]==="upload" && request.path=="/") continue;
			hasContent = true;
			var iconIdx = getSysIconIndex(dir[dir[i]]);
			response.write('<li><a href="'
				,inet.url.append(request.path, inet.url.encode(dir[i]))
				,'?t='+srvHttp.userToken+'"><img src="/?icon='++(iconIdx)++'"><span class="fname">',string.html.escape(dir[i]),'</span></a></li>\r\n');
		}
		
		for(i=1;#file;1){
			hasContent = true;
			var iconIdx = getSysIconIndex(file[file[i]]);
			var encodedPath = inet.url.append(request.path, inet.url.encode(file[i]));
			var filePath = string.replace(request.path + file[i], "//", "/");
			var fileSize = io.getSize( io.joinpath(srvHttp.documentRoot, request.path, file[i]) );
			
			response.write('<li><a href="'
				,encodedPath,'?t='+srvHttp.userToken+'"><img src="/?icon='++(iconIdx)++'"><span class="fname">',string.html.escape(file[i]),'</span>');
			
			response.write('<span class="fsize">' + formatSize(fileSize) + '</span></a>');
			
			if(isUploadDir){
				var jsPath = string.replace(filePath,"'","\\'"); 
				response.write('<button class="del-btn" onclick="deleteFile(\''
					,jsPath,'\', this)">åˆ é™¤</button>');
			}
			response.write('</li>\r\n');
		}
		
		if(!hasContent && request.path!="/"){
			response.write('<li class="empty-tip">ğŸ“­ ç›®å½•ä¸ºç©º</li>');
		}
		elseif(!hasContent && request.path=="/"){
			response.write('<li class="empty-tip">ğŸ“­ æš‚æ— æ–‡ä»¶ï¼Œè¯·é€šè¿‡"ä¸Šä¼ "æ ‡ç­¾é¡µæ·»åŠ æ–‡ä»¶</li>');
		}
		
		response.write("</ul></body></html>")
	} 	
);

var serverInfo = function(){
	var ip,port = srvHttp.getLocalIp();
	winform.editPort.text = port;
	winform.editDocumentRoot.text = io.fullpath(srvHttp.documentRoot)

	var home = "/";
	if(winform.radioQrUploadDir.checked){
		home = "/%3Cupload%3E/";
	}
	elseif(winform.radioQrClipboard.checked){
		home = "/%3Cclipboard%3E/";
	}
	elseif(winform.radioQrInputMethod.checked){
		home = "/%3Cinput%3E/";
	}
	
	var url = srvHttp.getUrl(home,true);
	
	var customUrl = string.trim(winform.editHost.text);
	if(#customUrl){ 
		if( inet.url.is(customUrl,-1) ){
			url = customUrl;
		}
		elseif(string.startsWith(customUrl,"natapp:",true)){
		 	url = winform.natAppTunnelUrl;
		} 
		else{
			url = "http://"+customUrl;
		}  
	} 
	elseif(winform.chkPublicAddress.checked){
		var tUrl = inet.url.split(url);
		
		winform.chkPublicAddress.disabled = true;
		winform.btnStart.disabledText = ['\uF254','\uF251','\uF252','\uF253','\uF250',text='è·å– IP']
		var resp = thread.invokeAndWait(
			function(){
				import wsock.udp.stunClient;
        		var sutn = wsock.udp.stunClient();
        		return sutn.getPublicAddress();
			} 
		)
		
		winform.chkPublicAddress.disabled = false;
		winform.btnStart.disabledText = null;
		 
        if(resp){
            tUrl.host = resp.ip;
            url = tostring(tUrl);
        }
	}
	
	var tUrl = inet.url.split(url);
	if(!tUrl){
		return winform.msgboxErr("æŒ‡å®šäº†é”™è¯¯çš„ç½‘å€");
	}
	
	url = tostring( tUrl );
	
	if(#srvHttp.userToken){
		url = inet.url.appendExtraInfo(url,{
			t = srvHttp.userToken;
		})
	} 
	
	winform.txtMessage.text = 'HTTP æœåŠ¡ç«¯å·²å¯åŠ¨: \n'; 
	winform.txtMessage.print( url ); 
	
	var qrBmp = qrencode.bitmap( url );
    winform.qr.setForeground(qrBmp.copyBitmap(winform.qr.width)); 
		
	if(winform.chkPublicAddress.checked){
		winform.txtMessage.print( 
			"
æ‰‹æœºæ— çº¿è¿æ¥ç”µè„‘å±€åŸŸç½‘ã€‚
æ‰«ç æ‰“å¼€ç½‘é¡µå³å¯äº’ä¼ æ–‡ä»¶ï¼Œå…±äº«ç”µè„‘å‰ªè´´æ¿ã€æ‰‹æœºè¾“å…¥æ³•ã€‚
æ‹–åŠ¨æ–‡ä»¶æˆ–ç›®å½•åˆ°çª—å£ç½‘é¡µè‡ªåŠ¨åˆ·æ–°ã€‚

åŸºäºçº¯ aardio ä»£ç å®ç°çš„å¼€æºå•çº¿ç¨‹å¼‚æ­¥ HTTP / WebSocket åŒæœåŠ¡ç«¯ï¼Œä½“ç§¯ä»…æ•°å KBã€‚"
		); 			
	}
	else{
		winform.txtMessage.print( 
			"
æ‰‹æœºæ— çº¿è¿æ¥ç”µè„‘å±€åŸŸç½‘ã€‚
æ‰«ç æ‰“å¼€ç½‘é¡µå³å¯äº’ä¼ æ–‡ä»¶ï¼Œå…±äº«ç”µè„‘å‰ªè´´æ¿ã€æ‰‹æœºè¾“å…¥æ³•ã€‚
æ‹–åŠ¨æ–‡ä»¶æˆ–ç›®å½•åˆ°çª—å£ç½‘é¡µè‡ªåŠ¨åˆ·æ–°ã€‚

æœ¬å·¥å…·åªèµ°å†…ç½‘ï¼Œä¸èµ°å…¬ç½‘ï¼
ç«¯å£ä¸å¯†é’¥åŠ¨æ€æ”¹å˜ï¼ŒåŒé‡å®‰å…¨ä¿éšœã€‚

åŸºäºçº¯ aardio ä»£ç å®ç°çš„å¼€æºå•çº¿ç¨‹å¼‚æ­¥ HTTP / WebSocket åŒæœåŠ¡ç«¯ï¼Œä½“ç§¯ä»…æ•°å KBã€‚"
		); 		
	} 
}

winform.btnStart.oncommand = function(id,event){
	winform.txtMessage.text = "";
	winform.btnStart.disabledText = {'\uF254';'\uF251';'\uF252';'\uF253';'\uF250'}
	thread.delay(500);
 
	var customUrl = string.trim(winform.editHost.text);
	if(#customUrl){ 
		if(string.startsWith(customUrl,"natapp:",true)){
			if(..natapp){
				..natapp.terminate()
			}
			
		 	var token = string.right(customUrl,-8); 
		 	
		 	import process.natapp;
		 	..natapp = process.natapp(token,winform.edi,"INFO")
		 	if(natapp[["tunnelUrl"]]){
		 		winform.natAppTunnelUrl = natapp.tunnelUrl;
		 		winform.editPort.text = 80;
		 	}
		 	else{
		 		winform.btnStart.disabledText = null;
		 		return winform.msgboxErr("é”™è¯¯çš„ NATAPP ä»¤ç‰Œ");
		 	}
		}
		
		config.winform.editHost = customUrl; 
	}
	else{
		config.winform.editHost = null;
	}
	
	config.saveAll();
	
	var port = tonumber(winform.editPort.text);
	
	srvHttp.documentRoot = fsys.isDir(winform.editDocumentRoot.text) ? winform.editDocumentRoot.text;
	srvHttp.userToken = winform.editPassword.text;
	srvHttp.start("0.0.0.0",port);
	serverInfo();
	
	winform.btnStart.disabledText = null;
}

winform.txtMessage.enablePopMenu();
winform.txtMessage.onHyperlink = function(message,href){
	if( message = 0x202/*_WM_LBUTTONUP*/ ) {
		process.openUrl(href);
	}
}

winform.onDropFiles = function(files){
	var path = files[1]
	if(!fsys.isDir(path)){
		path = fsys.getParentDir(path)
	}
	
	winform.editDocumentRoot.text = path;
	srvHttp.documentRoot = path;
	config.winform.documentRoot = path;
	config.winform.save();
	
	wsrv.publish("reload");
}

winform.btnOpen.oncommand = function(id,event){
	var dir = fsys.dlg.dir(winform.editDocumentRoot.text,winform)
	if(dir){
		winform.editDocumentRoot.text = dir;
		srvHttp.documentRoot = dir;
		
		config.winform.documentRoot = dir;
		config.winform.save();
		wsrv.publish("reload");
	}
}

winform.btnOpenUpload.oncommand = function(id,event){
	var path = io.joinpath(winform.editDocumentRoot.text,"upload")
	if(io.createDir(path)){
		process.explore(path)
	}
}

var clipViewer = win.clip.viewer(winform);
clipViewer.onDrawClipboard=function(){
	var str = win.clip.read();	
	//if(str!=wsrv.lastReceivedClipboardData ){
		if(#str) wsrv.publish(str) 
		//wsrv.lastReceivedClipboardData = null;   
	//}
}

import key;
wsrv.onMessage = function(hSocket,msg){
	var data = JSON.tryParse(msg.data)
	if(!data) return;
	
	if(data.event=="clipboard"){
		wsrv.lastReceivedClipboardData = data.content; 
		win.clip.write(data.content);	
	}
	elseif(data.event=="input"){
		if(!winform.chkAiOpt.checked){
			key.sendString(data.content)
		}
		else{
			thread.invoke( 
				function(winform,aiOpt,text){
					import key;
					import web.rest.aiChat;
					var aiClient = web.rest.aiChat(aiOpt)  
					
					var msg = web.rest.aiChat.message();
					msg.system(aiOpt.systemPrompt) 
					msg.prompt( "è¯·ä¿®å¤è¯­éŸ³è¯†åˆ«ç»“æœ: " + text );
			 		 
			 		import winex.loading;
					var loading = winex.loading("æ­£åœ¨ä¼˜åŒ–",hFocus)
				
					var resp,err = aiClient.messages(msg,
						function(deltaText,reasoning){
					 		if(reasoning){ 
								return loading.thinking(reasoning);
							}
							
							if(loading.isCanceled()){
								return false;
							}
							
							key.sendString(deltaText) 
						}
					);
					 
				},winform,config.aiOpt,data.content
			)
		}
	}
}

var updateHomeDir = function(){
	var home = "/";
	if(winform.radioQrUploadDir.checked){
		home = "/%3Cupload%3E/";
	}
	elseif(winform.radioQrClipboard.checked){
		home = "/%3Cclipboard%3E/";
	}
	elseif(winform.radioQrInputMethod.checked){
		home = "/%3Cinput%3E/";
	} 
	
	var url = srvHttp.getUrl(home,true);

	if(#srvHttp.userToken){
		url = url ++ "?t=" + srvHttp.userToken;
	}  
	
	var qrBmp = qrencode.bitmap( url );
    winform.qr.setBackground(qrBmp.copyBitmap(winform.qr.width)); 	
}

winform.radioQrRootDir.oncommand = function(id,event){
	config.winform.qrDir = "root";
	updateHomeDir();
}

winform.radioQrUploadDir.oncommand = function(id,event){
	config.winform.qrDir = "upload";
	updateHomeDir();	
}

winform.radioQrClipboard.oncommand = function(id,event){
	config.winform.qrDir = "clipboard";	
	updateHomeDir();
}

winform.radioQrInputMethod.oncommand = function(id,event){
	config.winform.qrDir = "input";
	updateHomeDir();
}

winform.show();  
win.ui.simpleWindow2(winform);

var revealIcon = winform.editPassword.addCtrl(
	cls="plus";
	marginRight=0;marginBottom=2;
	width=24; 
	iconText = '\uF023';
	iconStyle={
		align="right";font=LOGFONT(h=-15;name='FontAwesome');padding={top=3}
	}
)

revealIcon.skin({
	color = {
		default = 0xC0000000;
		hover = 0xFFFF0000;
		active = 0xFF00FF00;
	};
	checked = {
		iconText = '\uF06E';
	}
})

revealIcon.onMouseClick = function(){
    winform.editPassword.editBox.passwordChar = !owner.checked ? "*" : null;
}

winform.btnSetting.oncommand = function(id,event){
	..table.assign(config.aiOpt,{
		title = "æ‰«ç å¿«ä¼  - è®¾ç½® AI ä¼˜åŒ–åŠ©æ‰‹";
	});
		
	import web.rest.aiChat.settingForm;
	var frmSetting = web.rest.aiChat.settingForm(this,config.aiOpt);
	
	if( frmSetting.doModal(this) ){
		..table.assign(config.aiOpt,config.itemData[config.selItem] );
	}
}

winform.chkAiOpt.checked = config.winform.checkAiOpt;
winform.onDestroy = function(){
    config.winform.checkAiOpt = winform.chkAiOpt.checked;
}

winform.editHost.editBox.setCueBannerText("è‡ªå®šä¹‰è®¿é—®åŸŸå")

winform.chkPublicAddress.oncommand = function(id,event){

	if(winform.chkPublicAddress.checked){
		import win.version;
		
		if(win.version.isServer){
			import win.ts; 
			if( win.ts.session.isRemote() ){
    			import wsock.tcp.server;
    			if( wsock.tcp.server.isFreePort(80)) winform.editPort.text = 80;
			} 
		}	
	}

	winform.btnStart.oncommand();
}

import gdip.imageAttributes;
var imgAttr = gdip.imageAttributes()

//æ›¿æ¢å‰æ™¯å›¾åƒï¼ˆäºŒç»´ç ï¼‰é¢œè‰²
imgAttr.setRemapTable({ 
	0xFF000000; 0xFF00A1D9; // ä»…å°†äºŒç»´ç ä¸­çš„é»‘è‰²ï¼ˆ0xFF000000ï¼‰æ›¿æ¢ä¸ºç»¿è‰²ï¼ˆ0xFF008000ï¼‰ï¼Œä¸æ›¿æ¢ç™½è‰²
	0xFFFFFFFF; 0xFFFAFAFA;
}); 
winform.qr.imageAttributes = imgAttr

winform.btnStart.skin( {
	background={
		default=0xFF00A1D9;
		hover=0xFFFF5C65;
		active=0xFF1295C7;
		disabled=0xFFCCCCCC; 
	}
})

winform.btnOpen.skin( {
	background={
		default=0;
		hover=0xFF928BB3;
		disabled=0xFFCCCCCC; 
	}
})

winform.btnOpenUpload.skin( {
	background={
		default=0;
		hover=0xFF928BB3;
		disabled=0xFFCCCCCC; 
	}
})

winform.btnSetting.skin({
	color={
		active=0xFF00FF00;
		default=0xFF3C3C3C;
		disabled=0xFF999999;
		hover=0xFFFF0000		
	}
})

serverInfo();

win.loopMessage();